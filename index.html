<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IT Help Site ‚Äî Rowe Casa Organics</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    :root { --sb-muted: #6a5e57; }
    html  { font-size: 17px; }

    /* ‚îÄ‚îÄ Role badge ‚îÄ‚îÄ */
    .role-badge {
      font-size: 0.68rem; font-weight: 800; padding: 0.22rem 0.65rem;
      border-radius: 999px; letter-spacing: 0.04em; text-transform: uppercase;
      white-space: nowrap; display: none; /* shown by JS once role is known */
    }
    .role-badge[data-role]                { display: inline-block; }
    .role-badge[data-role="it_admin"]     { background: rgba(46,204,138,0.15); color: #1aaf72; }
    .role-badge[data-role="leadership"]   { background: rgba(95,75,60,0.12);   color: #5f4b3c; }
    .role-badge[data-role="director"]     { background: rgba(189,153,121,0.2); color: #8d5e30; }
    .role-badge[data-role="manager"]      { background: rgba(245,166,35,0.15); color: #b8860b; }
    .role-badge[data-role="staff"]        { background: var(--sidebar-bg);     color: var(--sb-muted); border:1px solid var(--sb-border); }

    /* ‚îÄ‚îÄ Copy toast ‚îÄ‚îÄ */
    .copy-toast {
      position: fixed; bottom: 1.75rem; left: 50%;
      transform: translateX(-50%) translateY(8px);
      background: #2ecc8a; color: #fff; font-size: 0.82rem; font-weight: 700;
      padding: 0.55rem 1.4rem; border-radius: 999px;
      box-shadow: 0 4px 16px rgba(46,204,138,0.35);
      opacity: 0; transition: opacity 0.22s, transform 0.22s;
      pointer-events: none; z-index: 900; white-space: nowrap;
    }
    .copy-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* ‚îÄ‚îÄ Sidebar email button ‚îÄ‚îÄ */
    .portal-email-btn {
      display: block; width: 100%; background: none; border: none;
      border-radius: 8px; padding: 0.4rem 0.6rem;
      font-size: 0.67rem; color: var(--sb-muted);
      font-family: inherit; font-weight: 600; cursor: pointer;
      text-align: center; transition: all 0.18s; margin-top: 4px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .portal-email-btn:hover { background: var(--brand-soft); color: var(--brand-brown); }

    /* ‚îÄ‚îÄ Copy link icon button on cards ‚îÄ‚îÄ */
    .card-copy-btn {
      display: inline-flex; align-items: center; justify-content: center;
      background: none; border: none; color: var(--sb-muted);
      padding: 0.2rem 0.35rem; border-radius: 6px; font-size: 0.75rem;
      font-family: inherit; cursor: pointer; transition: all 0.15s; min-width: 24px;
    }
    .card-copy-btn:hover { color: var(--brand-brown); background: var(--brand-soft); }
    .card-copy-btn.disabled { opacity: 0.3; cursor: not-allowed; pointer-events: none; }

    /* ‚îÄ‚îÄ Completed section ‚Äî organized ‚îÄ‚îÄ */
    .completed-type-block {
      margin-bottom: 2rem;
    }
    .completed-type-header {
      display: flex; align-items: center; justify-content: space-between;
      flex-wrap: wrap; gap: 0.5rem;
      padding-bottom: 0.6rem;
      margin-bottom: 0.9rem;
      border-bottom: 1.5px solid var(--sb-sep);
    }
    .completed-type-title {
      font-size: 0.78rem; font-weight: 800; text-transform: uppercase;
      letter-spacing: 0.07em; color: var(--sb-muted);
    }
    .completed-sheet-link {
      display: none; /* shown by JS for IT admins only */
      align-items: center; gap: 0.35rem;
      font-size: 0.75rem; font-weight: 700; color: var(--brand-brown);
      text-decoration: none;
      background: var(--brand-soft); border: 1.5px solid var(--brand-hover-border);
      padding: 0.28rem 0.75rem; border-radius: 7px; transition: all 0.15s;
      white-space: nowrap;
    }
    .completed-sheet-link:hover { background: var(--brand-grad); color: #fff; border-color: var(--brand-brown); }
    .completed-sheet-link.visible { display: inline-flex; }

    /* ‚îÄ‚îÄ Contact Guide Modal ‚îÄ‚îÄ */
    .cg-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.48);
      backdrop-filter: blur(7px); z-index: 600;
      display: flex; align-items: center; justify-content: center; padding: 1rem;
    }
    .cg-overlay.hidden { display: none; }
    .cg-box {
      background: var(--panel-bg); border: 1.5px solid var(--sb-border);
      border-radius: 20px; padding: 2rem 2.25rem;
      max-width: 620px; width: 100%; max-height: 88vh; overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.22);
    }
    .cg-box h2 { font-size: 1.2rem; font-weight: 800; color: var(--sb-text); margin-bottom: 0.3rem; }
    .cg-sub    { font-size: 0.85rem; color: var(--sb-muted); line-height: 1.6; margin-bottom: 1.5rem; }
    .cg-section { margin-bottom: 1.5rem; }
    .cg-section-title {
      font-size: 0.72rem; font-weight: 800; text-transform: uppercase;
      letter-spacing: 0.07em; color: var(--sb-muted);
      margin-bottom: 0.65rem; padding-bottom: 0.4rem; border-bottom: 1px solid var(--sb-sep);
    }
    .cg-methods { display: flex; flex-direction: column; gap: 0.5rem; }
    .cg-method {
      display: flex; align-items: center; gap: 0.85rem;
      background: var(--sidebar-bg); border: 1.5px solid var(--sb-border);
      border-radius: 11px; padding: 0.75rem 1rem;
    }
    .cg-method-icon {
      font-size: 1.25rem; flex-shrink: 0; width: 36px; height: 36px;
      background: var(--brand-soft); border-radius: 9px;
      display: flex; align-items: center; justify-content: center;
    }
    .cg-method-text strong { display: block; font-size: 0.88rem; color: var(--sb-text); font-weight: 700; }
    .cg-method-text span   { font-size: 0.8rem; color: var(--sb-muted); line-height: 1.5; }
    .cg-method-text a      { color: var(--brand-brown); font-weight: 700; text-decoration: none; }
    .cg-method-text a:hover { text-decoration: underline; }
    .cg-emergency {
      background: rgba(220,80,60,0.07); border: 1.5px solid rgba(220,80,60,0.28);
      border-radius: 12px; padding: 1rem 1.25rem;
    }
    .cg-emergency-head  { font-size: 0.92rem; font-weight: 800; color: #c0392b; margin-bottom: 0.55rem; }
    .cg-emergency-phone { font-size: 1.05rem; font-weight: 800; color: #c0392b; margin-bottom: 0.65rem; }
    .cg-emergency ul    { padding-left: 1.1rem; margin: 0; display: flex; flex-direction: column; gap: 0.3rem; }
    .cg-emergency ul li { font-size: 0.82rem; color: #8b2a1f; line-height: 1.5; }
    .cg-include-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.45rem; }
    @media(max-width:520px){ .cg-include-grid,.cg-examples,.cg-split { grid-template-columns: 1fr; } }
    .cg-include-item {
      display: flex; align-items: flex-start; gap: 0.5rem;
      background: var(--sidebar-bg); border: 1px solid var(--sb-border);
      border-radius: 9px; padding: 0.55rem 0.75rem;
      font-size: 0.8rem; color: var(--sb-text); line-height: 1.45;
    }
    .cg-include-item::before { content:'‚úì'; color: var(--success); font-weight: 800; font-size: 0.78rem; flex-shrink: 0; margin-top: 0.05rem; }
    .cg-examples { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
    .cg-ex-card { border-radius: 11px; padding: 0.9rem 1rem; border: 1.5px solid; }
    .cg-ex-good { background: var(--success-soft); border-color: rgba(46,204,138,0.3); }
    .cg-ex-bad  { background: rgba(220,80,60,0.06); border-color: rgba(220,80,60,0.22); }
    .cg-ex-label { font-size: 0.68rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 0.45rem; }
    .cg-ex-good .cg-ex-label { color: var(--success); }
    .cg-ex-bad  .cg-ex-label { color: #c0392b; }
    .cg-ex-card p   { font-size: 0.78rem; color: var(--sb-text); line-height: 1.55; margin: 0; }
    .cg-ex-why      { font-size: 0.73rem; color: var(--sb-muted); margin-top: 0.45rem; font-style: italic; }
    .cg-split { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
    .cg-split-card   { border-radius: 11px; padding: 0.9rem 1rem; border: 1.5px solid; }
    .cg-split-ticket { background: var(--success-soft); border-color: rgba(46,204,138,0.3); }
    .cg-split-call   { background: rgba(220,80,60,0.06); border-color: rgba(220,80,60,0.22); }
    .cg-split-head   { font-size: 0.78rem; font-weight: 800; margin-bottom: 0.5rem; }
    .cg-split-ticket .cg-split-head { color: var(--success); }
    .cg-split-call   .cg-split-head { color: #c0392b; }
    .cg-split-card ul    { padding-left: 1rem; margin: 0; display: flex; flex-direction: column; gap: 0.3rem; }
    .cg-split-card ul li { font-size: 0.79rem; color: var(--sb-text); line-height: 1.45; }
    .cg-bfcm {
      background: linear-gradient(135deg, #5f4b3c 0%, #8d8173 100%);
      border-radius: 12px; padding: 1rem 1.25rem;
      display: flex; gap: 0.75rem; align-items: flex-start;
    }
    .cg-bfcm-icon { font-size: 1.3rem; flex-shrink: 0; }
    .cg-bfcm-text strong { display: block; font-size: 0.9rem; color: #fff; font-weight: 800; margin-bottom: 0.25rem; }
    .cg-bfcm-text span   { font-size: 0.8rem; color: rgba(255,255,255,0.82); line-height: 1.5; }
    .cg-close {
      width: 100%; margin-top: 1.5rem; padding: 0.7rem;
      background: var(--brand-grad); color: #fff; border: none;
      border-radius: 10px; font-size: 0.9rem; font-weight: 700;
      font-family: inherit; cursor: pointer; transition: opacity 0.18s;
    }
    .cg-close:hover { opacity: 0.88; }

    /* ‚îÄ‚îÄ IT Admin submissions toggle ‚îÄ‚îÄ */
    .submissions-toggle {
      display: none; /* shown by JS for IT admins only */
      align-items: center; gap: 0.5rem;
      background: var(--sidebar-bg);
      border: 1.5px solid var(--sb-border);
      border-radius: 999px; padding: 0.25rem;
    }
    .submissions-toggle.visible { display: inline-flex; }
    .toggle-btn {
      padding: 0.32rem 0.9rem; border-radius: 999px; border: none;
      font-size: 0.75rem; font-weight: 700; font-family: inherit;
      cursor: pointer; transition: all 0.18s; background: none;
      color: var(--sb-muted);
    }
    .toggle-btn.active {
      background: var(--brand-grad); color: #fff;
      box-shadow: 0 2px 8px rgba(95,75,60,0.25);
    }

    /* ‚îÄ‚îÄ Auth loading overlay ‚îÄ‚îÄ */
    .auth-loading {
      position: absolute; inset: 0;
      background: var(--panel-bg);
      border-radius: 16px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      gap: 0.75rem; z-index: 50;
    }
    .auth-loading.hidden { display: none; }
    .auth-loading p { font-size: 0.85rem; color: var(--sb-muted); font-weight: 600; }

    /* ‚îÄ‚îÄ No-access notice for restricted surveys ‚îÄ‚îÄ */
    .access-notice {
      background: var(--sidebar-bg); border: 1.5px solid var(--sb-border);
      border-radius: 12px; padding: 2rem; text-align: center;
      color: var(--sb-muted); font-size: 0.875rem; display: none;
    }
    .access-notice.show { display: block; }
  </style>
</head>
<body>

  <div class="app-shell">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-logo-wrap">
        <img src="logo.png" alt="Rowe Casa Organics" class="sidebar-logo"/>
      </div>
      <div class="sidebar-divider"></div>
      <nav class="sidebar-nav">
        <button class="nav-btn active" data-section="surveys">
          <span class="nav-icon">üìã</span> Surveys
        </button>
        <button class="nav-btn" data-section="forms">
          <span class="nav-icon">üìù</span> Request Forms
        </button>
        <button class="nav-btn" data-section="completed">
          <span class="nav-icon">‚úÖ</span> Completed
        </button>
      </nav>
      <div class="sidebar-footer">
        <button class="nav-btn" data-section="knowledge" style="margin-bottom:8px">
          <span class="nav-icon"></span> IT Knowledge Base
        </button>
        <div class="sidebar-divider"></div>
        <button class="contact-btn" data-section="contact">‚úâÔ∏è Contact Us</button>
        <button class="portal-email-btn"
                title="Email itsupport@rowecasaorganics.com"
                onclick="window.open('https://mail.google.com/mail/?view=cm&fs=1&to=itsupport%40rowecasaorganics.com','_blank')">
          itsupport@rowecasaorganics.com
        </button>
      </div>
    </aside>

    <!-- MAIN WRAP -->
    <div class="main-wrap">

      <!-- TOP BAR -->
      <header class="topbar">
        <div class="topbar-left">
          <div class="topbar-title">Welcome to the RCO IT Help Site</div>
          <div class="topbar-desc">Submit surveys, request IT support, or reach out to our team directly.</div>
        </div>
        <div class="topbar-right">
          <span class="role-badge" id="roleBadge"></span>
          <span class="topbar-user" id="topbarUser">Not signed in</span>
          <button class="sign-btn" id="authBtn">Sign Out</button>
        </div>
      </header>

      <!-- CONTENT PANEL -->
      <main class="content-panel" style="position:relative">

        <!-- Shown while Firebase auth resolves; hidden once roles module fires -->
        <div class="auth-loading" id="authLoading">
          <div class="login-spinner"></div>
          <p>Loading your portal...</p>
        </div>

        <!-- ‚îÄ‚îÄ SURVEYS ‚îÄ‚îÄ -->
        <section class="section active" id="section-surveys">
          <div class="section-intro">
            <h2>IT Surveys</h2>
            <p>Complete your assigned surveys to help our team manage technology across the organization.</p>
            <p style="font-size:0.78rem;color:var(--sb-muted);margin-top:0.35rem">Feel free to resubmit anytime if you forgot to add something or need to make updates ‚Äî each submission is saved separately.</p>
          </div>

          <!-- Cards are shown/hidden by roles.js based on data-content-id -->
          <div class="cards">
            <div class="card brown" data-content-id="tech-discovery" style="display:none">
              <div class="card-top">
                <span class="card-status status-active">Active</span>
              </div>
              <h3>RCO IT Software Inventory</h3>
              <p>Help us build a complete inventory of every tool, app, SaaS platform, and account used across your department. For team leads and managers.</p>
              <div class="card-meta">
                <div class="card-meta-left">
                  <span class="meta-label">Est. completion time</span>
                  <span class="meta-value">10 ‚Äì 15 mins</span>
                </div>
                <div style="display:flex;align-items:center;gap:0.5rem">
                  <button class="card-copy-btn"
                          onclick="copyLink(getSurveyUrl('surveys/tech-discovery.html'), this)"
                          title="Copy a direct link to this survey">üîó</button>
                  <button class="card-action" id="startSurveyBtn">Start ‚Üí</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Shown if the signed-in user has no access to any survey -->
          <div class="access-notice" id="surveysAccessNotice">
            No surveys are currently assigned to your role. Check back soon or contact IT if you think this is an error.
          </div>
        </section>

        <!-- ‚îÄ‚îÄ FORMS ‚îÄ‚îÄ -->
        <section class="section" id="section-forms">
          <div class="section-intro">
            <h2>Request Forms</h2>
            <p>Submit IT requests for new employees, departing staff, or equipment and software needs.</p>
            <p style="font-size:0.78rem;color:var(--sb-muted);margin-top:0.35rem">Feel free to resubmit anytime if you forgot to add something or need to make updates ‚Äî each submission is saved separately.</p>
          </div>
          <div class="cards">
            <div class="card brown" data-content-id="onboarding" style="display:none">
              <div class="card-top"><span class="card-status status-draft">In Progress</span></div>
              <h3>User Onboarding Request</h3>
              <p>Submit everything IT needs to provision a new employee ‚Äî role, system access, devices, and software requirements.</p>
              <div class="card-meta">
                <button class="card-copy-btn disabled" title="Link available when form is live">üîó</button>
                <button class="card-action disabled">Coming Soon</button>
              </div>
            </div>
            <div class="card brown" data-content-id="offboarding" style="display:none">
              <div class="card-top"><span class="card-status status-draft">In Progress</span></div>
              <h3>User Offboarding Request</h3>
              <p>Capture separation details for a departing employee ‚Äî access revocation, email handling, file transfer, and device return.</p>
              <div class="card-meta">
                <button class="card-copy-btn disabled" title="Link available when form is live">üîó</button>
                <button class="card-action disabled">Coming Soon</button>
              </div>
            </div>
            <div class="card brown" data-content-id="equipment" style="display:none">
              <div class="card-top"><span class="card-status status-draft">In Progress</span></div>
              <h3>IT Equipment &amp; Software Request</h3>
              <p>Request any technology need ‚Äî hardware, software, or licenses ‚Äî with business justification and manager approval workflow.</p>
              <div class="card-meta">
                <button class="card-copy-btn disabled" title="Link available when form is live">üîó</button>
                <button class="card-action disabled">Coming Soon</button>
              </div>
            </div>
          </div>
          <div class="access-notice" id="formsAccessNotice">
            No forms are currently assigned to your role. Contact IT if you think this is an error.
          </div>
        </section>

        <!-- ‚îÄ‚îÄ COMPLETED ‚îÄ‚îÄ -->
        <section class="section" id="section-completed">
          <div class="section-intro">
            <h2>My Completed Submissions</h2>
            <p>A record of surveys and forms you have submitted.</p>
            <div style="display:flex;align-items:center;gap:0.75rem;margin-top:0.75rem;flex-wrap:wrap">
              <button class="clear-btn" style="margin:0" id="refreshBtn">‚Üª Refresh</button>
              <!-- IT admin only ‚Äî toggled visible by roles module -->
              <div class="submissions-toggle" id="submissionsToggle">
                <button class="toggle-btn active" id="toggleMine"
                        onclick="setSubmissionsView('mine')">My Submissions</button>
                <button class="toggle-btn" id="toggleAll"
                        onclick="setSubmissionsView('all')">All Submissions</button>
              </div>
            </div>
          </div>

          <!-- Surveys subsection -->
          <div class="completed-type-block">
            <div class="completed-type-header">
              <span class="completed-type-title">üìã Surveys</span>
              <!-- Sheet links are hidden by default; JS shows them for IT admins only -->
              <a id="sheetLink-tech-discovery"
                 class="completed-sheet-link"
                 href="https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID_HERE/edit"
                 target="_blank">
                üìä Software Inventory ‚Äî Sheets
              </a>
            </div>
            <div id="completedSurveysList">
              <div class="empty-state" style="padding:1.5rem 0">
                <p style="color:var(--sb-muted)">No survey submissions yet.</p>
              </div>
            </div>
          </div>

          <!-- Forms subsection -->
          <div class="completed-type-block">
            <div class="completed-type-header">
              <span class="completed-type-title">üìù Request Forms</span>
              <a id="sheetLink-onboarding"
                 class="completed-sheet-link"
                 href="https://docs.google.com/spreadsheets/d/YOUR_ONBOARDING_SHEET_ID/edit"
                 target="_blank">
                üìä Onboarding ‚Äî Sheets
              </a>
              <a id="sheetLink-offboarding"
                 class="completed-sheet-link"
                 href="https://docs.google.com/spreadsheets/d/YOUR_OFFBOARDING_SHEET_ID/edit"
                 target="_blank">
                üìä Offboarding ‚Äî Sheets
              </a>
              <a id="sheetLink-equipment"
                 class="completed-sheet-link"
                 href="https://docs.google.com/spreadsheets/d/YOUR_EQUIPMENT_SHEET_ID/edit"
                 target="_blank">
                üìä Equipment Requests ‚Äî Sheets
              </a>
            </div>
            <div id="completedFormsList">
              <div class="empty-state" style="padding:1.5rem 0">
                <p style="color:var(--sb-muted)">No form submissions yet.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- ‚îÄ‚îÄ KNOWLEDGE BASE ‚îÄ‚îÄ -->
        <section class="section" id="section-knowledge">
          <div class="section-intro">
            <h2>IT Knowledge Base</h2>
            <p>Guides, how-tos, and IT documentation for the RCO team.</p>
          </div>
          <div class="construction-wrap">
            <div class="construction-badge">
              <div class="construction-emoji">üöß</div>
              <span class="construction-tag">Coming Soon</span>
              <h2>Under Construction</h2>
              <p>The IT Knowledge Base is being built out. Check back soon for guides, FAQs, and documentation.</p>
            </div>
          </div>
        </section>

        <!-- ‚îÄ‚îÄ CONTACT ‚îÄ‚îÄ -->
        <section class="section" id="section-contact">
          <div class="section-intro">
            <h2>Contact IT Support</h2>
            <p>Reach out to the RCO IT team ‚Äî use the form below to compose a message, or email us directly.</p>
          </div>

          <div style="background:var(--sidebar-bg);border:1.5px solid var(--sb-border);border-radius:14px;
                      padding:1.25rem 1.5rem;margin-bottom:1.25rem;max-width:580px">
            <h3 style="font-size:0.88rem;font-weight:800;color:var(--sb-text);margin-bottom:0.6rem">How to Contact IT</h3>
            <p style="font-size:0.875rem;color:var(--sb-muted);line-height:1.7;margin-bottom:0.9rem">
              For general IT support, questions, or requests, the best way to reach us is by submitting a ticket or
              emailing us directly. We typically respond within one business day.
            </p>
            <button onclick="document.getElementById('cgModal').classList.remove('hidden')"
                    style="display:inline-flex;align-items:center;gap:0.45rem;
                           background:var(--brand-soft);border:1.5px solid var(--brand-hover-border);
                           color:var(--brand-brown);padding:0.5rem 1.1rem;border-radius:9px;
                           font-size:0.875rem;font-weight:700;font-family:inherit;cursor:pointer;transition:all 0.15s"
                    onmouseover="this.style.background='var(--brand-grad)';this.style.color='#fff';this.style.borderColor='var(--brand-brown)'"
                    onmouseout="this.style.background='var(--brand-soft)';this.style.color='var(--brand-brown)';this.style.borderColor='var(--brand-hover-border)'">
              üìã How to Contact IT ‚Äî Full Guide
            </button>
          </div>

          <div class="contact-form-wrap">
            <div class="contact-field">
              <label for="contactFrom">Your Email Address</label>
              <input type="email" id="contactFrom" placeholder="yourname@rowecasaorganics.com"/>
            </div>
            <div class="contact-field">
              <label for="contactTo">To</label>
              <input type="text" id="contactTo" value="itsupport@rowecasaorganics.com" readonly/>
            </div>
            <div class="contact-field">
              <label for="contactSubject">Subject</label>
              <input type="text" id="contactSubject" placeholder="Brief description of your issue or request"/>
            </div>
            <div class="contact-field">
              <label for="contactBody">Message</label>
              <textarea id="contactBody" rows="6" placeholder="Describe your issue, request, or question in detail..."></textarea>
            </div>
            <div class="contact-actions">
              <button class="card-action" id="sendBtn">Send Message ‚Üí</button>
              <button class="clear-btn" id="clearBtn">Clear</button>
            </div>
            <div id="contactStatus" class="contact-status"></div>
          </div>
        </section>

      </main>
    </div>
  </div>

  <!-- Copy toast -->
  <div id="copyToast" class="copy-toast">üîó Link copied to clipboard!</div>

  <!-- ‚îÄ‚îÄ How to Contact IT Modal ‚îÄ‚îÄ -->
  <div class="cg-overlay hidden" id="cgModal"
       onclick="if(event.target===this)this.classList.add('hidden')">
    <div class="cg-box">
      <h2>How to Contact IT</h2>
      <p class="cg-sub">We use tickets to ensure every issue is tracked, prioritized, and handled by the right person ‚Äî without anything slipping through the cracks. Submitting through the correct channel helps us respond faster and keep operations running smoothly.</p>
      <div class="cg-section">
        <div class="cg-section-title">‚úÖ Preferred Methods ‚Äî Each creates a ticket automatically</div>
        <div class="cg-methods">
          <div class="cg-method"><div class="cg-method-icon">‚úâÔ∏è</div><div class="cg-method-text"><strong>Email</strong><span><a href="mailto:itsupport@rowecasaorganics.com">itsupport@rowecasaorganics.com</a></span></div></div>
          <div class="cg-method"><div class="cg-method-icon">üåê</div><div class="cg-method-text"><strong>IT Portal</strong><span><a href="https://it.rowecasaorganics.com" target="_blank">it.rowecasaorganics.com</a></span></div></div>
          <div class="cg-method"><div class="cg-method-icon">üí¨</div><div class="cg-method-text"><strong>Slack</strong><span>#rco-it-support</span></div></div>
          <div class="cg-method"><div class="cg-method-icon">üñ•Ô∏è</div><div class="cg-method-text"><strong>System Tray Ticket Form</strong><span>Click the RCO IT Agent icon near the clock ‚Üí select <em>IT Ticket Form</em> ‚Üí fill in details ‚Üí Save.</span></div></div>
        </div>
      </div>
      <div class="cg-section">
        <div class="cg-section-title">üö® Emergencies ‚Äî Critical Issues Only</div>
        <div class="cg-emergency">
          <div class="cg-emergency-head">üìû IT Emergency Line</div>
          <div class="cg-emergency-phone">469-893-1998</div>
          <p style="font-size:0.8rem;color:#8b2a1f;margin-bottom:0.6rem;line-height:1.5">Use this only for true critical events:</p>
          <ul>
            <li>Internet or network outage ‚Äî wait ~5‚Äì10 minutes first</li>
            <li>Major system failure where nobody can work</li>
            <li>Any cybersecurity event (suspected hacking, phishing link clicked, etc.)</li>
            <li>Production or shipping halted due to IT issues</li>
            <li>Google Workspace or Deacom outages</li>
          </ul>
        </div>
      </div>
      <div class="cg-section">
        <div class="cg-section-title">üìù What to Include in Your Ticket</div>
        <div class="cg-include-grid">
          <div class="cg-include-item">What you were trying to do</div>
          <div class="cg-include-item">What happened (describe the issue)</div>
          <div class="cg-include-item">What should have happened</div>
          <div class="cg-include-item">Any error messages (text or screenshot)</div>
          <div class="cg-include-item">Device location (Office, Warehouse, Station #)</div>
          <div class="cg-include-item">Whether others are affected</div>
          <div class="cg-include-item">Whether you've already rebooted</div>
          <div class="cg-include-item">Anyone else who needs to be notified</div>
        </div>
      </div>
      <div class="cg-section">
        <div class="cg-section-title">üß© Good vs. Bad Ticket Examples</div>
        <div class="cg-examples">
          <div class="cg-ex-card cg-ex-good">
            <div class="cg-ex-label">‚úÖ Good Ticket</div>
            <p><strong>Subject:</strong> Can't print labels on Station 14<br/><br/>While printing shipping labels in Chrome, I get "Printer unreachable." Started at 9:40 AM. Rebooted computer and printer ‚Äî error persists. Model: Zebra ZD421. We can still print to Station 12. Screenshot attached.</p>
            <p class="cg-ex-why">Clear, detailed, and immediately actionable.</p>
          </div>
          <div class="cg-ex-card cg-ex-bad">
            <div class="cg-ex-label">‚ùå Bad Ticket</div>
            <p><strong>Subject:</strong> Printer broken<br/><br/>Printer doesn't work. Please fix ASAP.</p>
            <p class="cg-ex-why">Missing: location, device info, error details, steps already tried.</p>
          </div>
        </div>
      </div>
      <div class="cg-section">
        <div class="cg-section-title">üìû When to Ticket vs. When to Call</div>
        <div class="cg-split">
          <div class="cg-split-card cg-split-ticket">
            <div class="cg-split-head">‚úÖ Submit a Ticket</div>
            <ul>
              <li>Issue affecting one or a few users</li>
              <li>Multi-user issue with a workaround available</li>
              <li>General requests (equipment, software, moves)</li>
              <li>Access changes (badges, printers, permissions)</li>
              <li>General IT questions</li>
            </ul>
          </div>
          <div class="cg-split-card cg-split-call">
            <div class="cg-split-head">üö® Call Immediately</div>
            <ul>
              <li>Multiple people can't work ‚Äî no workaround</li>
              <li>Production or shipping stopped or severely slowed</li>
              <li>Entire site loses internet or network</li>
              <li>Deacom, Google Workspace, or core systems down</li>
            </ul>
          </div>
        </div>
        <p style="font-size:0.8rem;color:var(--sb-muted);margin-top:0.75rem;font-style:italic">Simple rule: If it affects everyone or critical work stops ‚Äî call us.</p>
      </div>
      <div class="cg-section" style="margin-bottom:0">
        <div class="cg-bfcm">
          <div class="cg-bfcm-icon">üî∫</div>
          <div class="cg-bfcm-text">
            <strong>BFCM Blackout ‚Äî Nov 28 ‚Äì Dec 13</strong>
            <span>All issues impacting production or shipping are escalated to high priority. Call immediately for anything affecting fulfillment during this window.</span>
          </div>
        </div>
      </div>
      <button class="cg-close" onclick="document.getElementById('cgModal').classList.add('hidden')">Got it ‚Äî Close Guide</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       UTILITY SCRIPTS (non-module, runs immediately)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
    // Fallback ‚Äî if roles module hasn't fired within 6s, remove overlay anyway
    setTimeout(function() {
      document.getElementById('authLoading')?.classList.add('hidden');
    }, 6000);

    // Track which view IT admins are on so refresh respects it
    window._submissionsView = 'mine';

    function setSubmissionsView(mode) {
      window._submissionsView = mode;
      // Update toggle button states
      document.getElementById('toggleMine').classList.toggle('active', mode === 'mine');
      document.getElementById('toggleAll').classList.toggle('active',  mode === 'all');
      // Re-render with the new mode
      if (typeof window._renderCompleted === 'function') window._renderCompleted();
    }

    function getSurveyUrl(path) {
      var href = window.location.href.split('?')[0].split('#')[0];
      var base = href.endsWith('/') ? href : href.substring(0, href.lastIndexOf('/') + 1);
      return base + path;
    }
    function copyLink(url, btn) {
      var done = function() {
        showToast();
        var orig = btn.innerHTML;
        btn.innerHTML = '‚úì'; btn.style.color = 'var(--success)';
        setTimeout(function() { btn.innerHTML = orig; btn.style.color = ''; }, 2000);
      };
      if (navigator.clipboard) {
        navigator.clipboard.writeText(url).then(done).catch(function() { fallbackCopy(url); done(); });
      } else { fallbackCopy(url); done(); }
    }
    function fallbackCopy(url) {
      var el = document.createElement('textarea');
      el.value = url; el.style.position = 'fixed'; el.style.opacity = '0';
      document.body.appendChild(el); el.select(); document.execCommand('copy');
      document.body.removeChild(el);
    }
    function showToast() {
      var t = document.getElementById('copyToast');
      t.classList.add('show');
      setTimeout(function() { t.classList.remove('show'); }, 2500);
    }
  </script>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       ROLE-BASED ACCESS  (module ‚Äî imports roles.js)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script type="module">
    import { initializeApp, getApps, getApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, onAuthStateChanged }     from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import {
      getRole, getRoleLabel,
      canAccess, canViewSheets,
      CONTENT_CONFIG
    } from './roles.js';

    const FIREBASE_CONFIG = {
      apiKey:'AIzaSyBRKBzxTYzBnBHo-YY8fSxTSSkM3uyujmc',
      authDomain:'ithelpsite-4ec53.firebaseapp.com',
      projectId:'ithelpsite-4ec53',
      storageBucket:'ithelpsite-4ec53.firebasestorage.app',
      messagingSenderId:'893459212285',
      appId:'1:893459212285:web:194adf30886cbb28c21b94'
    };
    const fbApp = getApps().length ? getApp() : initializeApp(FIREBASE_CONFIG);
    const auth  = getAuth(fbApp);

    onAuthStateChanged(auth, user => {
      if (!user || !user.email.endsWith('@rowecasaorganics.com')) return;
      const email = user.email;
      const role  = getRole(email);

      // 1. Role badge in topbar
      const badge = document.getElementById('roleBadge');
      if (badge) { badge.textContent = getRoleLabel(email); badge.dataset.role = role; }

      // 2. Pre-fill contact form
      const cf = document.getElementById('contactFrom');
      if (cf && !cf.value) cf.value = email;

      // 3. Show survey/form cards based on access
      let surveysVisible = 0, formsVisible = 0;
      document.querySelectorAll('[data-content-id]').forEach(card => {
        const id  = card.dataset.contentId;
        const cfg = [...CONTENT_CONFIG.surveys, ...CONTENT_CONFIG.forms].find(c => c.id === id);
        if (!cfg) return;
        const show = canAccess(email, id);
        card.style.display = show ? '' : 'none';
        if (show && CONTENT_CONFIG.surveys.some(s => s.id === id)) surveysVisible++;
        if (show && CONTENT_CONFIG.forms.some(f => f.id === id))   formsVisible++;
      });

      // Show "no access" notices if nothing is visible
      const sn = document.getElementById('surveysAccessNotice');
      const fn = document.getElementById('formsAccessNotice');
      if (sn) sn.classList.toggle('show', surveysVisible === 0);
      if (fn) fn.classList.toggle('show', formsVisible === 0);

      // 4. Google Sheets links ‚Äî IT admin only
      if (canViewSheets(email)) {
        document.querySelectorAll('.completed-sheet-link').forEach(el => el.classList.add('visible'));
      }

      // 5. Submissions toggle ‚Äî IT admin only
      if (window._canViewAllSubmissions) {
        document.getElementById('submissionsToggle')?.classList.add('visible');
      }

      // 6. Hide the loading overlay ‚Äî auth has resolved, cards are visible
      document.getElementById('authLoading')?.classList.add('hidden');

      // Expose role for app.js renderCompleted to use
      window._userEmail = email;
      window._userRole  = role;
      window._canViewSheets = canViewSheets(email);
      window._contentConfig = CONTENT_CONFIG;
    });
  </script>

  <!-- app.js handles auth state, nav, contact form, and renderCompleted -->
  <script type="module" src="app.js"></script>

</body>
</html>
